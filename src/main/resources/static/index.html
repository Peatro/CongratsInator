<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CongratsInator</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #818181;
            padding: 8px;
            text-align: left;
            vertical-align: middle;
        }

        input, button, select {
            margin: 4px 0;
        }

        img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        nav a {
            margin-right: 12px;
        }
    </style>
</head>
<body>

<h1>CongratsInator</h1>

<nav>
    <a href="/index.html">Главная</a>
    <a href="/persons.html">Все дни рождения</a>
</nav>

<section>
    <h2>Сегодняшние дни рождения</h2>
    <table>
        <thead>
        <tr>
            <th>Фото</th>
            <th>Имя</th>
            <th>Дата</th>
        </tr>
        </thead>
        <tbody id="today-table"></tbody>
    </table>
</section>

<section>
    <h2>Ближайшие дни рождения</h2>
    <label for="upcoming-days">Период (дней):</label>
    <input id="upcoming-days" type="number" min="1" value="7">
    <button onclick="fetchUpcoming()">Показать</button>

    <table>
        <thead>
        <tr>
            <th>Фото</th>
            <th>Имя</th>
            <th>Дата</th>
        </tr>
        </thead>
        <tbody id="upcoming-table"></tbody>
    </table>
</section>

<script>
    async function renderTable(tbodyId, data) {
        const tbody = document.getElementById(tbodyId);
        tbody.innerHTML = '';

        if (!data.length) {
            const tr = document.createElement('tr');
            tr.innerHTML = '<td colspan="3">Нет записей</td>';
            tbody.appendChild(tr);
            return;
        }

        data.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${p.photoUrl ? `<img src="${p.photoUrl}" alt="photo">` : '—'}</td>
                <td>${p.name}</td>
                <td>${p.birthday}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function fetchToday() {
        const res = await fetch('/api/birthdays/today');
        if (!res.ok) {
            console.error('Failed to fetch today birthdays:', res.status);
            return;
        }

        const data = await res.json();
        await renderTable('today-table', data);
    }

    async function fetchUpcoming() {
        const daysInput = document.getElementById('upcoming-days');
        const days = Number(daysInput.value || 7);

        const res = await fetch(`/api/birthdays/upcoming?days=${days}`);
        if (!res.ok) {
            console.error('Failed to fetch upcoming birthdays:', res.status);
            return;
        }

        const data = await res.json();
        await renderTable('upcoming-table', data);
    }

    fetchToday();
    fetchUpcoming();
</script>

</body>
</html>